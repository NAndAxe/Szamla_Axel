<!DOCTYPE html>
<html lang="hu">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vev≈ëk √©s Ki√°ll√≠t√≥k</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: chocolate;
      color: #eee;
    }

    h1 {
      color: greenyellow;
    }

    input,
    button,
    select {
      margin: 5px 0;
      padding: 2px;
      font-size: 1rem;
    }

    .entity,
    .header-row {
      margin: 10px 0;
      padding: 10px;
      background: #333;
      border-radius: 6px;
      display: flex;
      align-items: center;
    }

    .entity span,
    .header-row span {
      display: inline-block;
      width: 200px;
    }

    .entity span:nth-child(2),
    .header-row span:nth-child(2) {
      margin-right: 40px;
    }

    .header-row span {
      font-weight: bold;
    }

    .formok {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .form-container {
      flex: 1;
      background: orangered;
      padding: 10px;
      border-radius: 6px;
    }
    #szamla{
      display: none;
    }
    #vESk{
      display: none;
    }
    
  </style>
  <script>
    const showFormBtn = document.getElementById('szamlajelen');
  const szamlaaddForm = document.getElementById('szamlaadd');

  showFormBtn.addEventListener('click', () => {
    if (szamlaaddForm.style.display === 'none' || szamlaaddForm.style.display === '') {
      szamlaaddForm.style.display = 'block';
    } else {
      szamlaaddForm.style.display = 'none';
    }
  });
  </script>
</head>

<body>
  <h1>Vev≈ëk √©s Ki√°ll√≠t√≥k kezel√©se</h1>

  <div>
    <button onclick="betoltSzamlak()" id="szamlajelen">Sz√°ml√°k megjelen√≠t√©se</button>
    <button onclick="betoltVevok()">Vev≈ëk megjelen√≠t√©se</button>
    <button onclick="betoltKiallitok()">Ki√°ll√≠t√≥k megjelen√≠t√©se</button>
  </div>

  <div class="formok">

    <div class="form-container" id="szamla">
      <h2>√öj sz√°mla hozz√°ad√°sa</h2>
      <input type="text" id="vnev" placeholder="Vev≈ë neve" /><br />
      <input type="text" id="knev" placeholder="Ki√°ll√≠t√≥ neve" /><br />
      <input type="text" id="szszama" placeholder="Sz√°mla sz√°ma" /><br />
      <input type="text" id="vegosszeg" placeholder="V√©g√∂sszeg" /><br />
      <input type="text" id="afa" placeholder="√Åfa" /><br />
      <button onclick="ujSzamla()">‚ûï Hozz√°ad√°s</button>
    </div>

    <div class="form-container" id="vESk">
      <h2 id="addTitle">√öj elem hozz√°ad√°sa</h2>
      <input type="text" id="nev" placeholder="N√©v" /><br />
      <input type="text" id="cim" placeholder="C√≠m" /><br />
      <input type="text" id="adoszam" placeholder="Ad√≥sz√°m" /><br />
      <button onclick="ujElem()">‚ûï Hozz√°ad√°s</button>
    </div>

    <div class="form-container">
      <h2 id="editTitle">Elem szerkeszt√©se</h2>
      <input type="hidden" id="szerk-id" />
      <input type="text" id="szerk-nev" placeholder="N√©v" /><br />
      <input type="text" id="szerk-cim" placeholder="C√≠m" /><br />
      <input type="text" id="szerk-adoszam" placeholder="Ad√≥sz√°m" /><br />
      <button onclick="mentSzerkesztes()">üíæ Ment√©s</button>
    </div>
  </div>

  <div id="entitasok"></div>

  <script>
    const API_BASE = "http://localhost:8080";
    let currentType = null; 


    async function betoltSzamlak() {
      document.getElementById("szamla").style.display="block";
      document.getElementById("vESk").style.display="none";
      currentType = "szamla";
      document.getElementById("addTitle").innerText = "√öj sz√°mla hozz√°ad√°sa";
      document.getElementById("editTitle").innerText = "Sz√°mla szerkeszt√©se";
      clearEditForm();

      try {
        const res = await fetch(`${API_BASE}/szamla`);
        if (!res.ok) throw new Error("Hiba a sz√°ml√°k lek√©r√©sekor");
        const szamlak = await res.json();
        renderEntities(szamlak);
      } catch (err) {
        document.getElementById("entitasok").innerHTML = `<p style="color:red;">Hiba: ${err.message}</p>`;
      }
    }


    async function betoltVevok() {
      document.getElementById("szamla").style.display="none";
      document.getElementById("vESk").style.display="block";
      currentType = "vevo";
      document.getElementById("addTitle").innerText = "√öj vev≈ë hozz√°ad√°sa";
      document.getElementById("editTitle").innerText = "Vev≈ë szerkeszt√©se";
      clearEditForm();
      try {
        const res = await fetch(`${API_BASE}/vevo`);
        if (!res.ok) throw new Error("Hiba a vev≈ëk lek√©r√©sekor");
        const vevok = await res.json();
        renderEntities(vevok);
      } catch (err) {
        document.getElementById("entitasok").innerHTML = `<p style="color:red;">Hiba: ${err.message}</p>`;
      }
    }

    async function betoltKiallitok() {
      document.getElementById("szamla").style.display="none";
      document.getElementById("vESk").style.display="block";
      currentType = "kiallito";
      document.getElementById("addTitle").innerText = "√öj ki√°ll√≠t√≥ hozz√°ad√°sa";
      document.getElementById("editTitle").innerText = "Ki√°ll√≠t√≥ szerkeszt√©se";
      clearEditForm();
      try {
        const res = await fetch(`${API_BASE}/kiallito`);
        if (!res.ok) throw new Error("Hiba a ki√°ll√≠t√≥k lek√©r√©sekor");
        const kiallitok = await res.json();
        renderEntities(kiallitok);
      } catch (err) {
        document.getElementById("entitasok").innerHTML = `<p style="color:red;">Hiba: ${err.message}</p>`;
      }
    }

    function renderEntities(items) {
  const container = document.getElementById("entitasok");
  container.innerHTML = "";

  if (!items.length) {
    container.innerHTML = "<p>Nincs megjelen√≠thet≈ë adat.</p>";
    return;
  }

  if (currentType === "szamla") {
    items.forEach(szamla => {
      let kiallito = {};
  let vevo = {};

  try {
    kiallito = JSON.parse(szamla.kiallito);
    vevo = JSON.parse(szamla.vevo);
  } catch (e) {
    console.error("Hib√°s JSON a ki√°ll√≠t√≥ vagy vev≈ë mez≈ëben:", e);
  }

      const card = document.createElement("div");
      card.style.background = "#444";
      card.style.borderRadius = "8px";
      card.style.padding = "15px";
      card.style.margin = "10px 0";
      card.style.color = "#eee";
      card.style.boxShadow = "0 2px 6px rgba(0,0,0,0.5)";
      card.style.display = "flex";
      card.style.flexDirection = "column";

      card.innerHTML = `
        <h3 style="margin:0 0 10px 0; border-bottom: 2px solid greenyellow; padding-bottom: 5px;">
          Sz√°mlasz√°m: ${szamla.szSzam}
        </h3>

        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <div style="flex: 1; padding-right: 10px; border-right: 1px solid #666;">
            <h4 style="margin-top: 0; color: lightblue;">Elad√≥ (Ki√°ll√≠t√≥)</h4>
            <p><strong>N√©v:</strong> ${kiallito.nev || "‚Äì"}</p>
            <p><strong>C√≠m:</strong> ${kiallito.cim || "‚Äì"}</p>
            <p><strong>Ad√≥sz√°m:</strong> ${kiallito.adoszam || "‚Äì"}</p>
          </div>

          <div style="flex: 1; padding-left: 10px;">
            <h4 style="margin-top: 0; color: lightgreen;">Vev≈ë</h4>
            <p><strong>N√©v:</strong> ${vevo.nev || "‚Äì"}</p>
            <p><strong>C√≠m:</strong> ${vevo.cim || "‚Äì"}</p>
            <p><strong>Ad√≥sz√°m:</strong> ${vevo.adoszam || "‚Äì"}</p>
          </div>
        </div>

        <div style="margin-bottom: 10px;">
          <p><strong>Sz√°mla kelte:</strong> ${szamla.szKelt ? new Date(szamla.szKelt).toLocaleDateString() : "‚Äì"}</p>
          <p><strong>Teljes√≠t√©s d√°tuma:</strong> ${szamla.tDatum ? new Date(szamla.tDatum).toLocaleDateString() : "‚Äì"}</p>
          <p><strong>Fizet√©si hat√°rid≈ë:</strong> ${szamla.fHatarido ? new Date(szamla.fHatarido).toLocaleDateString() : "‚Äì"}</p>
        </div>

        <div style="font-size: 1.1em; font-weight: bold; color: gold;">
          Nett√≥ √∂sszeg: ${szamla.vegosszeg} Ft<br />
          √ÅFA: ${szamla.afa} %
        </div>
      `;

      container.appendChild(card);
    });

    return;
  }

  const headerDiv = document.createElement("div");
  headerDiv.className = "header-row";
  headerDiv.innerHTML = `
    <span>N√©v</span>
    <span>C√≠m</span>
    <span>Ad√≥sz√°m</span>
    <span style="width:auto"></span>
  `;
  container.appendChild(headerDiv);

  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "entity";
    div.innerHTML = `
      <span>${item.nev}</span>
      <span>${item.cim}</span>
      <span>${item.adoszam}</span>
      <button onclick='szerkesztElem(${JSON.stringify(item)})'>Szerkeszt√©s</button>
      <button onclick="torolElem(${item.id})">T√∂rl√©s</button>
    `;
    container.appendChild(div);
  });
}



    async function ujElem() {
      if (!currentType) {
        return alert("El≈ëbb v√°laszd ki, hogy vev≈ët vagy ki√°ll√≠t√≥t szeretn√©l kezelni!");
      }
      const nev = document.getElementById("nev").value.trim();
      const cim = document.getElementById("cim").value.trim();
      const adoszam = document.getElementById("adoszam").value.trim();
      if (!nev || !cim || !adoszam) {
        return alert("T√∂lts ki minden mez≈ët!");
      }
      try {
        await fetch(`${API_BASE}/${currentType}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nev, cim, adoszam })
        });
        document.getElementById("nev").value = "";
        document.getElementById("cim").value = "";
        document.getElementById("adoszam").value = "";
        if (currentType === "vevo") await betoltVevok();
        else await betoltKiallitok();
      } catch (err) {
        alert(`Hiba: ${err.message}`);
      }
    }

    async function torolElem(id) {
      if (!confirm("Biztosan t√∂rl√∂d?")) return;
      try {
        await fetch(`${API_BASE}/${currentType}/${id}`, { method: "DELETE" });
        if (currentType === "vevo") await betoltVevok();
        else await betoltKiallitok();
      } catch (err) {
        alert(`Hiba: ${err.message}`);
      }
    }

    function szerkesztElem(item) {
      document.getElementById("szerk-id").value = item.id;
      document.getElementById("szerk-nev").value = item.nev;
      document.getElementById("szerk-cim").value = item.cim;
      document.getElementById("szerk-adoszam").value = item.adoszam;
    }

    async function mentSzerkesztes() {
      const id = document.getElementById("szerk-id").value;
      const nev = document.getElementById("szerk-nev").value.trim();
      const cim = document.getElementById("szerk-cim").value.trim();
      const adoszam = document.getElementById("szerk-adoszam").value.trim();
      if (!id) return alert("Hi√°nyzik az elem ID!");
      if (!nev || !cim || !adoszam) return alert("T√∂lts ki minden mez≈ët!");
      try {
        await fetch(`${API_BASE}/${currentType}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nev, cim, adoszam })
        });
        document.getElementById("szerk-id").value = "";
        document.getElementById("szerk-nev").value = "";
        document.getElementById("szerk-cim").value = "";
        document.getElementById("szerk-adoszam").value = "";
        if (currentType === "vevo") await betoltVevok();
        else await betoltKiallitok();
      } catch (err) {
        alert(`Hiba: ${err.message}`);
      }
    }

    function clearEditForm() {
      document.getElementById("szerk-id").value = "";
      document.getElementById("szerk-nev").value = "";
      document.getElementById("szerk-cim").value = "";
      document.getElementById("szerk-adoszam").value = "";
    }
  </script>
</body>

</html>